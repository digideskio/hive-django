{% extends "base.html" %}
{% load directory %}
{% load static from staticfiles %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/typeaheadjs.css' %}">
{% endblock %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="jumbotron">
  <h1>Welcome to the Hive Directory.</h1>
  <input class="form-control" data-staticsearchbox placeholder="Search for organizations and people here">
</div>
{% for org in orgs %}
  <h2 id="org_{{ org.slug }}" data-staticsearchable>{{ org.name }}</h2>
  <p>
    <a href="{{ org.website }}">{{ org.website|domainname }}</a>
    {% for channel in org.content_channels.all %}
      {% if channel.category != 'other' %}
        <a href="{{ channel.url }}" title="{{ channel.display_name }}"><i class="fa {{ channel.fa_icon }}"></i></a>
      {% endif %}
    {% endfor %}
  </p>
  <p><small>Hive member since {{ org.hive_member_since|date:"F Y" }}</small></p>
  <p>{{ org.mission|markdown }}</p>
  {% if user.is_superuser or user.membership.organization == org %}
    <p><a href="{% url 'organization_profile' org.slug %}" class="btn btn-sm btn-default">Edit</a></p>
  {% endif %}
  {% if show_privileged_info %}
    <ul class="media-list">
    {% for membership in org.membership_directory %}
      <li class="media">
        <img class="pull-left media-object" src="//gravatar.com/avatar/{{ membership.user.email|emailhash }}?d=mm" alt="gravatar for {{ membership.user.email }}">
        <div class="media-body">
          <address><strong id="user_{{ membership.user.username }}" data-staticsearchable>{{ membership.user.get_full_name }}</strong><br>
            {% if membership.title %}{{ membership.title }}<br>{% endif %}
            {% if membership.phone_number %}
            <a href="tel:+1-{{membership.phone_number}}">{{membership.phone_number}}</a><br>
            {% endif %}
            {% if membership.twitter_name %}
            <a href="https://twitter.com/{{membership.twitter_name}}">@{{membership.twitter_name}}</a><br>
            {% endif %}
          
          <a href="mailto:{{ membership.user.email }}">{{ membership.user.email }}</a>
          {% if user.is_superuser and user != membership.user %}
            <a href="#" class="btn btn-default btn-xs" data-submit-form-onclick>
              <form method="post" action="{% url 'switch_user' membership.user.username %}">
                {% csrf_token %}
              </form>
              Login as this user
            </a>
          {% endif %}
          {% if user == membership.user %}
            <a href="{% url 'user_profile' %}" class="btn btn-default btn-xs">Edit</a>
          {% endif %}
          </address>
        </div>
      </li>
    {% endfor %}
    </ul>
  {% endif %}
{% endfor %}
{% endblock %}

{% block scripts %}
  <script src="{% static 'js/typeahead.jquery.js' %}"></script>
  <script src="{% static 'js/staticsearch.js' %}"></script>
{% endblock %}
